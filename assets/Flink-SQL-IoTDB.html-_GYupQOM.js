import{_ as o,r as e,o as c,c as l,d as n,e as s,b as p,f as a}from"./app-1OOS2xKC.js";const i={},u=a(`<h1 id="flink-sql-iotdb-connector" tabindex="-1"><a class="header-anchor" href="#flink-sql-iotdb-connector" aria-hidden="true">#</a> flink-sql-iotdb-connector</h1><p>flink-sql-iotdb-connector å°† Flink SQL æˆ–è€… Flink Table ä¸ IoTDB æ— ç¼è¡”æ¥äº†èµ·æ¥ï¼Œä½¿å¾—åœ¨ Flink çš„ä»»åŠ¡ä¸­å¯ä»¥å¯¹ IoTDB è¿›è¡Œå®æ—¶è¯»å†™ï¼Œå…·ä½“å¯ä»¥åº”ç”¨åˆ°å¦‚ä¸‹åœºæ™¯ä¸­ï¼š</p><ol><li>å®æ—¶æ•°æ®åŒæ­¥ï¼šå°†æ•°æ®ä»ä¸€ä¸ªæ•°æ®åº“å®æ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ã€‚</li><li>å®æ—¶æ•°æ®ç®¡é“ï¼šæ„å»ºå®æ—¶æ•°æ®å¤„ç†ç®¡é“ï¼Œå¤„ç†å’Œåˆ†ææ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</li><li>å®æ—¶æ•°æ®åˆ†æï¼šå®æ—¶åˆ†ææ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæä¾›å®æ—¶çš„ä¸šåŠ¡æ´å¯Ÿã€‚</li><li>å®æ—¶åº”ç”¨ï¼šå°†æ•°æ®åº“ä¸­çš„æ•°æ®å®æ—¶åº”ç”¨äºå®æ—¶åº”ç”¨ç¨‹åºï¼Œå¦‚å®æ—¶æŠ¥è¡¨ã€å®æ—¶æ¨èç­‰ã€‚</li><li>å®æ—¶ç›‘æ§ï¼šå®æ—¶ç›‘æ§æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ£€æµ‹å¼‚å¸¸å’Œé”™è¯¯ã€‚</li></ol><h2 id="è¯»å†™æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#è¯»å†™æ¨¡å¼" aria-hidden="true">#</a> è¯»å†™æ¨¡å¼</h2><table><thead><tr><th>è¯»æ¨¡å¼ï¼ˆSourceï¼‰</th><th>å†™æ¨¡å¼ï¼ˆSinkï¼‰</th></tr></thead><tbody><tr><td>Bounded Scan, Lookup, CDC</td><td>Streaming Sink, Batch Sink</td></tr></tbody></table><h3 id="è¯»æ¨¡å¼-source" tabindex="-1"><a class="header-anchor" href="#è¯»æ¨¡å¼-source" aria-hidden="true">#</a> è¯»æ¨¡å¼ï¼ˆSourceï¼‰</h3><ul><li><p><strong>Bounded Scanï¼š</strong> bounded scan çš„ä¸»è¦å®ç°æ–¹å¼æ˜¯é€šè¿‡æŒ‡å®š <code>æ—¶é—´åºåˆ—</code> ä»¥åŠ <code>æŸ¥è¯¢æ¡ä»¶çš„ä¸Šä¸‹ç•Œï¼ˆå¯é€‰ï¼‰</code>æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢ç»“æœé€šå¸¸ä¸ºå¤šè¡Œæ•°æ®ã€‚è¿™ç§æŸ¥è¯¢æ— æ³•è·å–åˆ°æŸ¥è¯¢ä¹‹åæ›´æ–°çš„æ•°æ®ã€‚</p></li><li><p><strong>Lookupï¼š</strong> lookup æŸ¥è¯¢æ¨¡å¼ä¸ scan æŸ¥è¯¢æ¨¡å¼ä¸åŒï¼Œbounded scan æ˜¯å¯¹ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œ <code>lookup</code> æŸ¥è¯¢åªä¼šå¯¹ä¸€ä¸ªç²¾ç¡®çš„æ—¶é—´ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœåªæœ‰ä¸€è¡Œæ•°æ®ã€‚å¦å¤–åªæœ‰ <code>lookup join</code> çš„å³è¡¨æ‰èƒ½ä½¿ç”¨ lookup æŸ¥è¯¢æ¨¡å¼ã€‚</p></li><li><p><strong>CDC:</strong> ä¸»è¦ç”¨äº Flink çš„ <code>ETL</code> ä»»åŠ¡å½“ä¸­ã€‚å½“ IoTDB ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œflink ä¼šé€šè¿‡æˆ‘ä»¬æä¾›çš„ <code>CDC connector</code> æ„ŸçŸ¥åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„ŸçŸ¥åˆ°çš„å˜åŒ–æ•°æ®è½¬å‘ç»™å…¶ä»–çš„å¤–éƒ¨æ•°æ®æºï¼Œä»¥æ­¤è¾¾åˆ° ETL çš„ç›®çš„ã€‚</p></li></ul><h3 id="å†™æ¨¡å¼-sink" tabindex="-1"><a class="header-anchor" href="#å†™æ¨¡å¼-sink" aria-hidden="true">#</a> å†™æ¨¡å¼ï¼ˆSinkï¼‰</h3><ul><li><p><strong>Streaming sinkï¼š</strong> ç”¨äº Flink çš„ streaming mode ä¸­ï¼Œä¼šå°† Flink ä¸­ Dynamic Table çš„å¢åˆ æ”¹è®°å½•å®æ—¶çš„åŒæ­¥åˆ° IoTDB ä¸­ã€‚</p></li><li><p><strong>Batch sinkï¼š</strong> ç”¨äº Flink çš„ batch mode ä¸­ï¼Œç”¨äºå°† Flink çš„æ‰¹é‡è®¡ç®—ç»“æœä¸€æ¬¡æ€§å†™å…¥ IoTDB ä¸­ã€‚</p></li></ul><h2 id="ä½¿ç”¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ–¹å¼" aria-hidden="true">#</a> ä½¿ç”¨æ–¹å¼</h2><p>æˆ‘ä»¬æä¾›çš„ flink-sql-iotdb-connector æ€»å…±æä¾›ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é€šè¿‡ Maven çš„æ–¹å¼å¼•ç”¨ï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨ Flink çš„ sql-client ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚</p><blockquote><p>ğŸ“Œæ³¨ï¼šflink ç‰ˆæœ¬è¦æ±‚ 1.17.0 åŠä»¥ä¸Š</p></blockquote><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven" aria-hidden="true">#</a> Maven</h3><p>æˆ‘ä»¬åªéœ€è¦åœ¨é¡¹ç›®çš„ pom æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å³å¯ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.iotdb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-sql-iotdb-connector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${iotdb.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql-client" tabindex="-1"><a class="header-anchor" href="#sql-client" aria-hidden="true">#</a> sql-client</h3><p>å¦‚æœéœ€è¦åœ¨ sql-client ä¸­ä½¿ç”¨ flink-sql-iotdb-connectorï¼Œå…ˆé€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥é…ç½®ç¯å¢ƒï¼š</p>`,17),d={href:"https://iotdb.apache.org/Download/",target:"_blank",rel:"noopener noreferrer"},k=n("li",null,[n("p",null,[s("å°† jar åŒ…æ‹·è´åˆ° "),n("code",null,"$FLINK_HOME/lib"),s(" ç›®å½•ä¸‹ã€‚")])],-1),r=n("li",null,[n("p",null,"å¯åŠ¨ Flink é›†ç¾¤ã€‚")],-1),m=n("li",null,[n("p",null,"å¯åŠ¨ sql-clientã€‚")],-1),v=a(`<p>æ­¤æ—¶å°±å¯ä»¥åœ¨ sql-client ä¸­ä½¿ç”¨ flink-sql-iotdb-connector äº†ã€‚</p><h2 id="è¡¨ç»“æ„è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#è¡¨ç»“æ„è§„èŒƒ" aria-hidden="true">#</a> è¡¨ç»“æ„è§„èŒƒ</h2><p>æ— è®ºä½¿ç”¨å“ªç§ç±»å‹çš„è¿æ¥å™¨ï¼Œéƒ½éœ€è¦æ»¡è¶³ä»¥ä¸‹çš„è¡¨ç»“æ„è§„èŒƒï¼š</p><ul><li>æ‰€æœ‰ä½¿ç”¨ <code>IoTDB connector</code> çš„è¡¨ï¼Œç¬¬ä¸€åˆ—çš„åˆ—åå¿…é¡»æ˜¯ <code>Time_</code>ï¼Œè€Œä¸”æ•°æ®ç±»å‹å¿…é¡»æ˜¯ <code>BIGINT</code> ç±»å‹ã€‚</li><li>é™¤äº† <code>Time_</code> åˆ—ä»¥å¤–çš„åˆ—åå¿…é¡»ä»¥ <code>root.</code> å¼€å¤´ã€‚å¦å¤–åˆ—åä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸èƒ½æ˜¯çº¯æ•°å­—ï¼Œå¦‚æœæœ‰çº¯æ•°å­—ï¼Œæˆ–è€…å…¶ä»–éæ³•å­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åå¼•å·æ‰©èµ·æ¥ã€‚æ¯”å¦‚ï¼šè·¯å¾„ root.sg.d0.123 æ˜¯ä¸€ä¸ªéæ³•è·¯å¾„ï¼Œä½†æ˜¯ root.sg.d0.\`123\` å°±æ˜¯ä¸€ä¸ªåˆæ³•è·¯å¾„ã€‚</li><li>æ— è®ºä½¿ç”¨ <code>pattern</code> æˆ–è€… <code>sql</code> ä» IoTDB ä¸­æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢ç»“æœçš„æ—¶é—´åºåˆ—åéœ€è¦åŒ…å« Flink ä¸­é™¤äº† <code>Time_</code> ä»¥å¤–çš„æ‰€æœ‰åˆ—åã€‚å¦‚æœæ²¡æœ‰æŸ¥è¯¢ç»“æœä¸­æ²¡æœ‰ç›¸åº”çš„åˆ—åï¼Œåˆ™è¯¥åˆ—å°†ç”¨ null å»å¡«å……ã€‚</li><li>flink-sql-iotdb-connector ä¸­æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰ï¼š<code>INT</code>, <code>BIGINT</code>, <code>FLOAT</code>, <code>DOUBLE</code>, <code>BOOLEAN</code>, <code>STRING</code>ã€‚Flink Table ä¸­æ¯ä¸€åˆ—çš„æ•°æ®ç±»å‹ä¸å…¶ IoTDB ä¸­å¯¹åº”çš„æ—¶é—´åºåˆ—ç±»å‹éƒ½è¦åŒ¹é…ä¸Šï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ï¼Œå¹¶é€€å‡º Flink ä»»åŠ¡ã€‚</li></ul><p>ä»¥ä¸‹ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ IoTDB ä¸­çš„æ—¶é—´åºåˆ—ä¸ Flink Table ä¸­åˆ—çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="è¯»æ¨¡å¼-source-1" tabindex="-1"><a class="header-anchor" href="#è¯»æ¨¡å¼-source-1" aria-hidden="true">#</a> è¯»æ¨¡å¼ï¼ˆSourceï¼‰</h2><h3 id="scan-table-bounded" tabindex="-1"><a class="header-anchor" href="#scan-table-bounded" aria-hidden="true">#</a> Scan Table (Bounded)</h3><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°" aria-hidden="true">#</a> å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>scan.bounded.lower-bound</td><td>å¦</td><td>-1L</td><td>Long</td><td>bounded çš„ scan æŸ¥è¯¢æ—¶çš„æ—¶é—´æˆ³ä¸‹ç•Œï¼ˆåŒ…æ‹¬ï¼‰ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶æœ‰æ•ˆã€‚</td></tr><tr><td>scan.bounded.upper-bound</td><td>å¦</td><td>-1L</td><td>Long</td><td>bounded çš„ scan æŸ¥è¯¢æ—¶çš„æ—¶é—´æˆ³ä¸‹ç•Œï¼ˆåŒ…æ‹¬ï¼‰ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶æœ‰æ•ˆã€‚</td></tr><tr><td>sql</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹" aria-hidden="true">#</a> ç¤ºä¾‹</h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table Job ä¸­ä» IoTDB ä¸­é€šè¿‡<code>scan table</code>çš„æ–¹å¼è¯»å–æ•°æ®ï¼š<br> å½“å‰ IoTDB ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>IoTDB&gt; select ** from root;
+-----------------------------+-------------+-------------+-------------+
|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|
+-----------------------------+-------------+-------------+-------------+
|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|
|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|
|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|
|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|
|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|
+-----------------------------+-------------+-------------+-------------+
Total line number = 5
It costs 0.028s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundedScanTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup table environment</span>
    <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
            <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">TableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// setup schema</span>
    <span class="token class-name">Schema</span> iotdbTableSchema <span class="token operator">=</span>
            <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// register table</span>
    <span class="token class-name">TableDescriptor</span> iotdbDescriptor <span class="token operator">=</span>
            <span class="token class-name">TableDescriptor</span><span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>iotdbTableSchema<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;nodeUrls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1:6667&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;select ** from root&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbTable&quot;</span><span class="token punctuation">,</span> iotdbDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// output table</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œä»¥ä¸Šä»»åŠ¡åï¼ŒFlink çš„æ§åˆ¶å°ä¸­è¾“å‡ºçš„è¡¨å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+
| op |                Time_ |                  root.sg.d0.s0 |                  root.sg.d1.s0 |                  root.sg.d1.s1 |
+----+----------------------+--------------------------------+--------------------------------+--------------------------------+
| +I |                    1 |                      1.0833644 |                        2.34874 |                      1.2414109 |
| +I |                    2 |                       4.929185 |                      3.1885583 |                      4.6980085 |
| +I |                    3 |                      3.5206156 |                      3.5600138 |                      4.8080945 |
| +I |                    4 |                      1.3449302 |                      2.8781595 |                      3.3195343 |
| +I |                    5 |                      3.3079383 |                      3.3840187 |                      3.7278645 |
+----+----------------------+--------------------------------+--------------------------------+--------------------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lookup-point" tabindex="-1"><a class="header-anchor" href="#lookup-point" aria-hidden="true">#</a> Lookup Point</h3><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1" aria-hidden="true">#</a> å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>lookup.cache.max-rows</td><td>å¦</td><td>-1</td><td>Integer</td><td>lookup æŸ¥è¯¢æ—¶ï¼Œç¼“å­˜è¡¨çš„æœ€å¤§è¡Œæ•°ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶ç”Ÿæ•ˆã€‚</td></tr><tr><td>lookup.cache.ttl-sec</td><td>å¦</td><td>-1</td><td>Integer</td><td>lookup æŸ¥è¯¢æ—¶ï¼Œå•ç‚¹æ•°æ®çš„ä¸¢å¼ƒæ—¶é—´ï¼Œå•ä½ä¸º<code>ç§’</code>ã€‚</td></tr><tr><td>sql</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1" aria-hidden="true">#</a> ç¤ºä¾‹</h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°† IoTDB ä¸­çš„<code>device</code>ä½œä¸ºç»´åº¦è¡¨è¿›è¡Œ<code>lookup</code>æŸ¥è¯¢ï¼š</p><ul><li>ä½¿ç”¨ <code>datagen connector</code> ç”Ÿæˆä¸¤ä¸ªå­—æ®µä½œä¸º <code>Lookup Join</code> çš„å·¦è¡¨ã€‚ç¬¬ä¸€ä¸ªå­—æ®µä¸ºè‡ªå¢å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæ—¶é—´æˆ³ã€‚ç¬¬äºŒä¸ªå­—æ®µä¸ºéšæœºå­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ª<br> measurement äº§ç”Ÿçš„æ—¶é—´åºåˆ—ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¡¨ä½œä¸º <code>Lookup Join</code> çš„å³è¡¨ã€‚</li><li>å°†ä¸¤ä¸ªè¡¨ join èµ·æ¥ã€‚</li></ul><p>å½“å‰ IoTDB ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>IoTDB&gt; select ** from root;
+-----------------------------+-------------+-------------+-------------+
|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|
+-----------------------------+-------------+-------------+-------------+
|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|
|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|
|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|
|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|
|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|
+-----------------------------+-------------+-------------+-------------+
Total line number = 5
It costs 0.028s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DataTypes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">EnvironmentSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Schema</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableEnvironment</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LookupTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup environment</span>
    <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
            <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">TableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// register left table</span>
    <span class="token class-name">Schema</span> dataGenTableSchema <span class="token operator">=</span>
            <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">INT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TableDescriptor</span> datagenDescriptor <span class="token operator">=</span>
            <span class="token class-name">TableDescriptor</span><span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;datagen&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>dataGenTableSchema<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.kind&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sequence&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.start&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.end&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.s0.min&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.s0.max&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;leftTable&quot;</span><span class="token punctuation">,</span> datagenDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// register right table</span>
    <span class="token class-name">Schema</span> iotdbTableSchema <span class="token operator">=</span>
            <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TableDescriptor</span> iotdbDescriptor <span class="token operator">=</span>
            <span class="token class-name">TableDescriptor</span><span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>iotdbTableSchema<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;select ** from root&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;rightTable&quot;</span><span class="token punctuation">,</span> iotdbDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// join</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span>
            <span class="token string">&quot;SELECT l.Time_, l.s0,r.\`root.sg.d0.s0\`, r.\`root.sg.d1.s0\`, r.\`root.sg.d1.s1\`&quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;FROM (select *,PROCTIME() as proc_time from leftTable) AS l &quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;JOIN rightTable FOR SYSTEM_TIME AS OF l.proc_time AS r &quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;ON l.Time_ = r.Time_&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// output table</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">sqlQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œä»¥ä¸Šä»»åŠ¡åï¼ŒFlink çš„æ§åˆ¶å°ä¸­è¾“å‡ºçš„è¡¨å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+----+----------------------+-------------+---------------+----------------------+--------------------------------+
| op |                Time_ |          s0 | root.sg.d0.s0 |        root.sg.d1.s0 |                  root.sg.d1.s1 |
+----+----------------------+-------------+---------------+----------------------+--------------------------------+
| +I |                    5 |           1 |     3.3079383 |            3.3840187 |                      3.7278645 |
| +I |                    2 |           1 |      4.929185 |            3.1885583 |                      4.6980085 |
| +I |                    1 |           1 |     1.0833644 |              2.34874 |                      1.2414109 |
| +I |                    4 |           1 |     1.3449302 |            2.8781595 |                      3.3195343 |
| +I |                    3 |           1 |     3.5206156 |            3.5600138 |                      4.8080945 |
+----+----------------------+-------------+---------------+----------------------+--------------------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cdc" tabindex="-1"><a class="header-anchor" href="#cdc" aria-hidden="true">#</a> CDC</h3><h4 id="å‚æ•°-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-2" aria-hidden="true">#</a> å‚æ•°</h4>`,28),b=n("thead",null,[n("tr",null,[n("th",null,"å‚æ•°"),n("th",null,"å¿…å¡«"),n("th",null,"é»˜è®¤"),n("th",null,"ç±»å‹"),n("th",null,"æè¿°")])],-1),g=n("tr",null,[n("td",null,"nodeUrls"),n("td",null,"å¦"),n("td",null,"127.0.0.1:6667"),n("td",null,"String"),n("td",null,"ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚")],-1),h=n("tr",null,[n("td",null,"user"),n("td",null,"å¦"),n("td",null,"root"),n("td",null,"String"),n("td",null,"IoTDB ç”¨æˆ·å")],-1),T=n("tr",null,[n("td",null,"password"),n("td",null,"å¦"),n("td",null,"root"),n("td",null,"String"),n("td",null,"IoTDB å¯†ç ")],-1),f=n("tr",null,[n("td",null,"mode"),n("td",null,"æ˜¯"),n("td",null,"BOUNDED"),n("td",null,"ENUM"),n("td",null,[n("strong",null,[s("å¿…é¡»å°†æ­¤å‚æ•°è®¾ç½®ä¸º "),n("code",null,"CDC"),s(" æ‰èƒ½å¯åŠ¨")])])],-1),q=n("tr",null,[n("td",null,"sql"),n("td",null,"æ˜¯"),n("td",null,"æ— "),n("td",null,"String"),n("td",null,"ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚")],-1),D=n("tr",null,[n("td",null,"cdc.port"),n("td",null,"å¦"),n("td",null,"8080"),n("td",null,"Integer"),n("td",null,"åœ¨ IoTDB ç«¯æä¾› CDC æœåŠ¡çš„ç«¯å£å·ã€‚")],-1),I={href:"http://cdc.task.name",target:"_blank",rel:"noopener noreferrer"},y=n("td",null,"æ˜¯",-1),S=n("td",null,"æ— ",-1),B=n("td",null,"String",-1),w=n("td",null,"å½“ mode å‚æ•°è®¾ç½®ä¸º CDC æ—¶æ˜¯å¿…å¡«é¡¹ã€‚ç”¨äºåœ¨ IoTDB ç«¯åˆ›å»º Pipe ä»»åŠ¡ã€‚",-1),_=n("tr",null,[n("td",null,"cdc.pattern"),n("td",null,"æ˜¯"),n("td",null,"æ— "),n("td",null,"String"),n("td",null,"å½“ mode å‚æ•°è®¾ç½®ä¸º CDC æ—¶æ˜¯å¿…å¡«é¡¹ã€‚ç”¨äºåœ¨ IoTDB ç«¯ä½œä¸ºå‘é€æ•°æ®çš„è¿‡æ»¤æ¡ä»¶ã€‚")],-1),x=a(`<h4 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2" aria-hidden="true">#</a> ç¤ºä¾‹</h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>CDC Connector</code> å»è·å– IoTDB ä¸­æŒ‡å®šè·¯å¾„ä¸‹çš„å˜åŒ–æ•°æ®ï¼š</p><ul><li>é€šè¿‡ <code>CDC Connector</code> åˆ›å»ºä¸€å¼  <code>CDC</code> è¡¨ã€‚</li><li>å°† <code>CDC</code> è¡¨æ‰“å°å‡ºæ¥ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDCTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup environment</span>
    <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
            <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">TableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// setup schema</span>
    <span class="token class-name">Schema</span> iotdbTableSchema <span class="token operator">=</span> <span class="token class-name">Schema</span>
            <span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// register table</span>
    <span class="token class-name">TableDescriptor</span> iotdbDescriptor <span class="token operator">=</span> <span class="token class-name">TableDescriptor</span>
            <span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>iotdbTableSchema<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CDC&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;cdc.task.name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;cdc.pattern&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root.sg&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbTable&quot;</span><span class="token punctuation">,</span> iotdbDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// output table</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä»¥ä¸Šçš„ Flink CDC ä»»åŠ¡ï¼Œç„¶ååœ¨ IoTDB-cli ä¸­æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span>d1<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span>s0<span class="token punctuation">,</span>s1<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span>d1<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span>s0<span class="token punctuation">,</span>s1<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span>d1<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span>s0<span class="token punctuation">,</span>s1<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span>d0<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span>s0<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼ŒFlink çš„æ§åˆ¶å°ä¸­å°†æ‰“å°è¯¥æ¡æ•°æ®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+
| op |                Time_ |                  root.sg.d0.s0 |                  root.sg.d1.s0 |                  root.sg.d1.s1 |
+----+----------------------+--------------------------------+--------------------------------+--------------------------------+
| +I |                    7 |                         &lt;NULL&gt; |                            1.0 |                            1.0 |
| +I |                    6 |                         &lt;NULL&gt; |                            1.0 |                            1.0 |
| +I |                    6 |                         &lt;NULL&gt; |                            2.0 |                            1.0 |
| +I |                    7 |                            2.0 |                         &lt;NULL&gt; |                         &lt;NULL&gt; |
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†™æ¨¡å¼-sink-1" tabindex="-1"><a class="header-anchor" href="#å†™æ¨¡å¼-sink-1" aria-hidden="true">#</a> å†™æ¨¡å¼ï¼ˆSinkï¼‰</h2><h3 id="streaming-sink" tabindex="-1"><a class="header-anchor" href="#streaming-sink" aria-hidden="true">#</a> Streaming Sink</h3><h4 id="å‚æ•°-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-3" aria-hidden="true">#</a> å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>aligned</td><td>å¦</td><td>false</td><td>Boolean</td><td>å‘ IoTDB å†™å…¥æ•°æ®æ—¶æ˜¯å¦è°ƒç”¨<code>aligned</code>æ¥å£ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3" aria-hidden="true">#</a> ç¤ºä¾‹</h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table çš„ Streaming Job ä¸­å¦‚ä½•å°†æ•°æ®å†™å…¥åˆ° IoTDB ä¸­ï¼š</p><ul><li>é€šè¿‡ <code>datagen connector</code> ç”Ÿæˆä¸€å¼ æºæ•°æ®è¡¨ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¾“å‡ºè¡¨ã€‚</li><li>å°†æ•°æ®æºè¡¨çš„æ•°æ®æ’å…¥åˆ°è¾“å‡ºè¡¨ä¸­ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DataTypes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">EnvironmentSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Schema</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Table</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableEnvironment</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamingSinkTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// setup environment</span>
        <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
                <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">TableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create data source table</span>
        <span class="token class-name">Schema</span> dataGenTableSchema <span class="token operator">=</span> <span class="token class-name">Schema</span>
                <span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TableDescriptor</span> descriptor <span class="token operator">=</span> <span class="token class-name">TableDescriptor</span>
                <span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;datagen&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>dataGenTableSchema<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;rows-per-second&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.kind&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sequence&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.start&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.Time_.end&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d0.s0.min&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d0.s0.max&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d1.s0.min&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d1.s0.max&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d1.s1.min&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;fields.root.sg.d1.s1.max&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// register source table</span>
        tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;dataGenTable&quot;</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> dataGenTable <span class="token operator">=</span> tableEnv<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dataGenTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create iotdb sink table</span>
        <span class="token class-name">TableDescriptor</span> iotdbDescriptor <span class="token operator">=</span> <span class="token class-name">TableDescriptor</span>
                <span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>dataGenTableSchema<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbSinkTable&quot;</span><span class="token punctuation">,</span> iotdbDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// insert data</span>
        dataGenTable<span class="token punctuation">.</span><span class="token function">executeInsert</span><span class="token punctuation">(</span><span class="token string">&quot;iotdbSinkTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œåœ¨ IoTDB çš„ cli ä¸­æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>IoTDB&gt; select ** from root;
+-----------------------------+-------------+-------------+-------------+
|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|
+-----------------------------+-------------+-------------+-------------+
|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|
|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|
|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|
|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|
|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|
+-----------------------------+-------------+-------------+-------------+
Total line number = 5
It costs 0.054s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="batch-sink" tabindex="-1"><a class="header-anchor" href="#batch-sink" aria-hidden="true">#</a> Batch Sink</h3><h4 id="å‚æ•°-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-4" aria-hidden="true">#</a> å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>aligned</td><td>å¦</td><td>false</td><td>Boolean</td><td>å‘ IoTDB å†™å…¥æ•°æ®æ—¶æ˜¯å¦è°ƒç”¨<code>aligned</code>æ¥å£ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-4" aria-hidden="true">#</a> ç¤ºä¾‹</h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table çš„ Batch Job ä¸­å¦‚ä½•å°†æ•°æ®å†™å…¥åˆ° IoTDB ä¸­ï¼š</p><ul><li>é€šè¿‡ <code>IoTDB connector</code> ç”Ÿæˆä¸€å¼ æºæ•°æ®è¡¨ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¾“å‡ºè¡¨ã€‚</li><li>å°†åŸæ•°æ®è¡¨ä¸­çš„åˆ—é‡å‘½ååå†™å…¥å†™å› IoTDBã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DataTypes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">EnvironmentSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Schema</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Table</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableEnvironment</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Expressions</span><span class="token punctuation">.</span>$<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchSinkTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup environment</span>
    <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
            <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inBatchMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">TableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// create source table</span>
    <span class="token class-name">Schema</span> sourceTableSchema <span class="token operator">=</span> <span class="token class-name">Schema</span>
            <span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableDescriptor</span> sourceTableDescriptor <span class="token operator">=</span> <span class="token class-name">TableDescriptor</span>
            <span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>sourceTableSchema<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;select ** from root.sg.d0,root.sg.d1&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;sourceTable&quot;</span><span class="token punctuation">,</span> sourceTableDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Table</span> sourceTable <span class="token operator">=</span> tableEnv<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sourceTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// register sink table</span>
    <span class="token class-name">Schema</span> sinkTableSchema <span class="token operator">=</span> <span class="token class-name">Schema</span>
            <span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;Time_&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">BIGINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d2.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d3.s0&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d3.s1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">FLOAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TableDescriptor</span> sinkTableDescriptor <span class="token operator">=</span> <span class="token class-name">TableDescriptor</span>
            <span class="token punctuation">.</span><span class="token function">forConnector</span><span class="token punctuation">(</span><span class="token string">&quot;IoTDB&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span>sinkTableSchema<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableEnv<span class="token punctuation">.</span><span class="token function">createTemporaryTable</span><span class="token punctuation">(</span><span class="token string">&quot;sinkTable&quot;</span><span class="token punctuation">,</span> sinkTableDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// insert data</span>
    sourceTable<span class="token punctuation">.</span><span class="token function">renameColumns</span><span class="token punctuation">(</span>
            $<span class="token punctuation">(</span><span class="token string">&quot;root.sg.d0.s0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d2.s0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            $<span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d3.s0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            $<span class="token punctuation">(</span><span class="token string">&quot;root.sg.d1.s1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;root.sg.d3.s1&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertInto</span><span class="token punctuation">(</span><span class="token string">&quot;sinkTable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œåœ¨ IoTDB çš„ cli ä¸­æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>IoTDB&gt; select ** from root;
+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+
|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|root.sg.d2.s0|root.sg.d3.s0|root.sg.d3.s1|
+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+
|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|    1.0833644|      2.34874|    1.2414109|
|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|     4.929185|    3.1885583|    4.6980085|
|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|    3.5206156|    3.5600138|    4.8080945|
|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|    1.3449302|    2.8781595|    3.3195343|
|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|    3.3079383|    3.3840187|    3.7278645|
+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+
Total line number = 5
It costs 0.015s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,27);function E(L,F){const t=e("ExternalLinkIcon");return c(),l("div",null,[u,n("ol",null,[n("li",null,[n("p",null,[s("åœ¨ "),n("a",d,[s("å®˜ç½‘"),p(t)]),s(" ä¸‹è½½å¸¦ä¾èµ–çš„ flink-sql-iotdb-connector çš„ jar åŒ…ã€‚")])]),k,r,m]),v,n("table",null,[b,n("tbody",null,[g,h,T,f,q,D,n("tr",null,[n("td",null,[n("a",I,[s("cdc.task.name"),p(t)])]),y,S,B,w]),_])]),x])}const O=o(i,[["render",E],["__file","Flink-SQL-IoTDB.html.vue"]]);export{O as default};
