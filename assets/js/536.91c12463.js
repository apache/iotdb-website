(window.webpackJsonp=window.webpackJsonp||[]).push([[536],{1160:function(t,e,a){"use strict";a.r(e);var _=a(83),s=Object(_.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-什么是metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是metrics"}},[t._v("#")]),t._v(" 1. 什么是Metrics?")]),t._v(" "),a("p",[t._v("在IoTDB运行过程中，我们希望对IoTDB的状态进行观测，以便于排查系统问题或者及时发现系统潜在的风险。能"),a("strong",[t._v("反映系统运行状态的一系列指标")]),t._v("就是metrics。")]),t._v(" "),a("h2",{attrs:{id:"_2-什么场景下会使用到metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-什么场景下会使用到metrics"}},[t._v("#")]),t._v(" 2. 什么场景下会使用到metrics?")]),t._v(" "),a("p",[t._v("那么什么时候会用到metrics呢？下面列举一些常见的场景。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("系统变慢了")]),t._v(" "),a("p",[t._v("系统变慢几乎是最常见也最头疼的问题，这时候我们需要尽可能多的信息来帮助我们找到系统变慢的原因，比如：")]),t._v(" "),a("ul",[a("li",[t._v("JVM信息：是不是有FGC？GC耗时多少？GC后内存有没有恢复？是不是有大量的线程？")]),t._v(" "),a("li",[t._v("系统信息：CPU使用率是不是太高了？磁盘IO是不是很频繁？")]),t._v(" "),a("li",[t._v("连接数：当前连接是不是太多？")]),t._v(" "),a("li",[t._v("接口：当前TPS是多少？各个接口耗时有没有变化？")]),t._v(" "),a("li",[t._v("线程池：系统中各种任务是否有积压？")]),t._v(" "),a("li",[t._v("缓存命中率")])])]),t._v(" "),a("li",[a("p",[t._v("磁盘快满了")]),t._v(" "),a("p",[t._v("这时候我们迫切想知道最近一段时间数据文件的增长情况，看看是不是某种文件有突增。")])]),t._v(" "),a("li",[a("p",[t._v("系统运行是否正常")]),t._v(" "),a("p",[t._v("此时我们可能需要通过错误日志的数量、集群节点的状态等指标来判断系统是否在正常运行。")])])]),t._v(" "),a("h2",{attrs:{id:"_3-什么人需要使用metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-什么人需要使用metrics"}},[t._v("#")]),t._v(" 3. 什么人需要使用metrics?")]),t._v(" "),a("p",[t._v("所有关注系统状态的人员都可以使用，包括但不限于研发、测试、运维、DBA等等")]),t._v(" "),a("h2",{attrs:{id:"_4-iotdb都有哪些metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-iotdb都有哪些metrics"}},[t._v("#")]),t._v(" 4. IoTDB都有哪些metrics?")]),t._v(" "),a("p",[t._v("目前，IoTDB对外提供一些主要模块的metrics，并且随着新功能的开发以及系统优化或者重构，metrics也会同步添加和更新。")]),t._v(" "),a("h3",{attrs:{id:"_4-1-名词解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-名词解释"}},[t._v("#")]),t._v(" 4.1. 名词解释")]),t._v(" "),a("p",[t._v("在进一步了解这些指标之前，我们先来看几个名词解释：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Metric Name")]),t._v(" "),a("p",[t._v("指标名称，比如logback_events_total表示日志事件发生的总次数。")])]),t._v(" "),a("li",[a("p",[t._v("Tag")]),t._v(" "),a("p",[t._v("每个指标下面可以有0到多个分类，比如logback_events_total下有一个"),a("code",[t._v("level")]),t._v("的分类，用来表示特定级别下的日志数量。")])])]),t._v(" "),a("h3",{attrs:{id:"_4-2-数据格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-数据格式"}},[t._v("#")]),t._v(" 4.2. 数据格式")]),t._v(" "),a("p",[t._v("IoTDB对外提供JMX和Prometheus格式的监控指标，对于JMX，可以通过"),a("code",[t._v("org.apache.iotdb.metrics")]),t._v("获取metrics指标。")]),t._v(" "),a("p",[t._v("接下来我们以Prometheus格式为例对目前已有监控项进行说明。")]),t._v(" "),a("h3",{attrs:{id:"_4-3-iotdb-默认指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-iotdb-默认指标"}},[t._v("#")]),t._v(" 4.3. IoTDB 默认指标")]),t._v(" "),a("h4",{attrs:{id:"_4-3-1-接入层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-接入层"}},[t._v("#")]),t._v(" 4.3.1. 接入层")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("entry_seconds_count")]),t._v(" "),a("td",[t._v('name="接口名"')]),t._v(" "),a("td",[t._v("接口累计访问次数")]),t._v(" "),a("td",[t._v('entry_seconds_count{name="openSession",} 1.0')])]),t._v(" "),a("tr",[a("td",[t._v("entry_seconds_sum")]),t._v(" "),a("td",[t._v('name="接口名"')]),t._v(" "),a("td",[t._v("接口累计耗时(s)")]),t._v(" "),a("td",[t._v('entry_seconds_sum{name="openSession",} 0.024')])]),t._v(" "),a("tr",[a("td",[t._v("entry_seconds_max")]),t._v(" "),a("td",[t._v('name="接口名"')]),t._v(" "),a("td",[t._v("接口最大耗时(s)")]),t._v(" "),a("td",[t._v('entry_seconds_max{name="openSession",} 0.024')])]),t._v(" "),a("tr",[a("td",[t._v("quantity_total")]),t._v(" "),a("td",[t._v('name="pointsIn"')]),t._v(" "),a("td",[t._v("系统累计写入点数")]),t._v(" "),a("td",[t._v('quantity_total{name="pointsIn",} 1.0')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-2-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-文件"}},[t._v("#")]),t._v(" 4.3.2. 文件")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("file_size")]),t._v(" "),a("td",[t._v('name="wal/seq/unseq"')]),t._v(" "),a("td",[t._v("当前时间wal/seq/unseq文件大小(byte)")]),t._v(" "),a("td",[t._v('file_size{name="wal",} 67.0')])]),t._v(" "),a("tr",[a("td",[t._v("file_count")]),t._v(" "),a("td",[t._v('name="wal/seq/unseq"')]),t._v(" "),a("td",[t._v("当前时间wal/seq/unseq文件个数")]),t._v(" "),a("td",[t._v('file_count{name="seq",} 1.0')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-3-flush"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-flush"}},[t._v("#")]),t._v(" 4.3.3. Flush")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("queue")]),t._v(" "),a("td",[t._v('name="flush",'),a("br"),t._v('status="running/waiting"')]),t._v(" "),a("td",[t._v("当前时间flush任务数")]),t._v(" "),a("td",[t._v('queue{name="flush",status="waiting",} 0.0'),a("br"),t._v('queue{name="flush",status="running",} 0.0')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_count")]),t._v(" "),a("td",[t._v('name="flush"')]),t._v(" "),a("td",[t._v("flush累计发生次数")]),t._v(" "),a("td",[t._v('cost_task_seconds_count{name="flush",} 1.0')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_max")]),t._v(" "),a("td",[t._v('name="flush"')]),t._v(" "),a("td",[t._v("到目前为止flush耗时(s)最大的一次")]),t._v(" "),a("td",[t._v('cost_task_seconds_max{name="flush",} 0.363')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_sum")]),t._v(" "),a("td",[t._v('name="flush"')]),t._v(" "),a("td",[t._v("flush累计耗时(s)")]),t._v(" "),a("td",[t._v('cost_task_seconds_sum{name="flush",} 0.363')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-4-compaction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-compaction"}},[t._v("#")]),t._v(" 4.3.4. Compaction")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("queue")]),t._v(" "),a("td",[t._v('name="compaction_inner/compaction_cross",'),a("br"),t._v('status="running/waiting"')]),t._v(" "),a("td",[t._v("当前时间compaction任务数")]),t._v(" "),a("td",[t._v('queue{name="compaction_inner",status="waiting",} 0.0')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_count")]),t._v(" "),a("td",[t._v('name="compaction"')]),t._v(" "),a("td",[t._v("compaction累计发生次数")]),t._v(" "),a("td",[t._v('cost_task_seconds_count{name="compaction",} 1.0')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_max")]),t._v(" "),a("td",[t._v('name="compaction"')]),t._v(" "),a("td",[t._v("到目前为止compaction耗时(s)最大的一次")]),t._v(" "),a("td",[t._v('cost_task_seconds_max{name="compaction",} 0.363')])]),t._v(" "),a("tr",[a("td",[t._v("cost_task_seconds_sum")]),t._v(" "),a("td",[t._v('name="compaction"')]),t._v(" "),a("td",[t._v("compaction累计耗时(s)")]),t._v(" "),a("td",[t._v('cost_task_seconds_sum{name="compaction",} 0.363')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-5-内存占用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-内存占用"}},[t._v("#")]),t._v(" 4.3.5. 内存占用")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("mem")]),t._v(" "),a("td",[t._v('name="chunkMetaData/storageGroup/mtree"')]),t._v(" "),a("td",[t._v("chunkMetaData/storageGroup/mtree占用的内存（byte）")]),t._v(" "),a("td",[t._v('mem{name="chunkMetaData",} 2050.0')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-6-缓存命中率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-6-缓存命中率"}},[t._v("#")]),t._v(" 4.3.6. 缓存命中率")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("cache_hit")]),t._v(" "),a("td",[t._v('name="chunk/timeSeriesMeta/bloomFilter"')]),t._v(" "),a("td",[t._v("chunk/timeSeriesMeta缓存命中率,bloomFilter拦截率")]),t._v(" "),a("td",[t._v('cache_hit{name="chunk",} 80')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-7-业务数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-7-业务数据"}},[t._v("#")]),t._v(" 4.3.7. 业务数据")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("quantity")]),t._v(" "),a("td",[t._v('name="timeSeries/storageGroup/device"')]),t._v(" "),a("td",[t._v("当前时间timeSeries/storageGroup/device的数量")]),t._v(" "),a("td",[t._v('quantity{name="timeSeries",} 1.0')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-3-8-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-8-集群"}},[t._v("#")]),t._v(" 4.3.8. 集群")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("cluster_node_leader_count")]),t._v(" "),a("td",[t._v('name="'+t._s(t.ip)+'"')]),t._v(" "),a("td",[t._v("节点上"),a("code",[t._v("dataGroupLeader")]),t._v("的数量，用来观察leader是否分布均匀")]),t._v(" "),a("td",[t._v('cluster_node_leader_count{name="127.0.0.1",} 2.0')])]),t._v(" "),a("tr",[a("td",[t._v("cluster_uncommitted_log")]),t._v(" "),a("td",[t._v('name="'+t._s(t.ip_datagroupHeader)+'"')]),t._v(" "),a("td",[t._v("节点"),a("code",[t._v("uncommitted_log")]),t._v("的数量")]),t._v(" "),a("td",[t._v('cluster_uncommitted_log{name="127.0.0.1_Data-127.0.0.1-40010-raftId-0",} 0.0')])]),t._v(" "),a("tr",[a("td",[t._v("cluster_node_status")]),t._v(" "),a("td",[t._v('name="'+t._s(t.ip)+'"')]),t._v(" "),a("td",[t._v("节点状态，1=online  2=offline")]),t._v(" "),a("td",[t._v('cluster_node_status{name="127.0.0.1",} 1.0')])]),t._v(" "),a("tr",[a("td",[t._v("cluster_elect_total")]),t._v(" "),a("td",[t._v('name="'+t._s(t.ip)+'",status="fail/win"')]),t._v(" "),a("td",[t._v("节点参与选举的次数及结果")]),t._v(" "),a("td",[t._v('cluster_elect_total{name="127.0.0.1",status="win",} 1.0')])])])]),t._v(" "),a("h3",{attrs:{id:"_4-4-iotdb-预定义指标集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-iotdb-预定义指标集"}},[t._v("#")]),t._v(" 4.4. IoTDB 预定义指标集")]),t._v(" "),a("p",[t._v("用户可以在"),a("code",[t._v("iotdb-metric.yml")]),t._v("文件中，修改"),a("code",[t._v("predefinedMetrics")]),t._v("的值来启用预定义指标集，其中"),a("code",[t._v("logback")]),t._v("在"),a("code",[t._v("dropwizard")]),t._v("中不支持。")]),t._v(" "),a("h4",{attrs:{id:"_4-4-1-jvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-jvm"}},[t._v("#")]),t._v(" 4.4.1. JVM")]),t._v(" "),a("h5",{attrs:{id:"_4-4-1-1-线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-1-线程"}},[t._v("#")]),t._v(" 4.4.1.1. 线程")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("jvm_threads_live_threads")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("当前线程数")]),t._v(" "),a("td",[t._v("jvm_threads_live_threads 25.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_threads_daemon_threads")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("当前daemon线程数")]),t._v(" "),a("td",[t._v("jvm_threads_daemon_threads 12.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_threads_peak_threads")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("峰值线程数")]),t._v(" "),a("td",[t._v("jvm_threads_peak_threads 28.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_threads_states_threads")]),t._v(" "),a("td",[t._v('state="runnable/blocked/waiting/timed-waiting/new/terminated"')]),t._v(" "),a("td",[t._v("当前处于各种状态的线程数")]),t._v(" "),a("td",[t._v('jvm_threads_states_threads{state="runnable",} 10.0')])])])]),t._v(" "),a("h5",{attrs:{id:"_4-4-1-2-垃圾回收"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-2-垃圾回收"}},[t._v("#")]),t._v(" 4.4.1.2. 垃圾回收")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("jvm_gc_pause_seconds_count")]),t._v(" "),a("td",[t._v('action="end of major GC/end of minor GC",cause="xxxx"')]),t._v(" "),a("td",[t._v("YGC/FGC发生次数及其原因")]),t._v(" "),a("td",[t._v('jvm_gc_pause_seconds_count{action="end of major GC",cause="Metadata GC Threshold",} 1.0')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_pause_seconds_sum")]),t._v(" "),a("td",[t._v('action="end of major GC/end of minor GC",cause="xxxx"')]),t._v(" "),a("td",[t._v("YGC/FGC累计耗时及其原因")]),t._v(" "),a("td",[t._v('jvm_gc_pause_seconds_sum{action="end of major GC",cause="Metadata GC Threshold",} 0.03')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_pause_seconds_max")]),t._v(" "),a("td",[t._v('action="end of major GC",cause="Metadata GC Threshold"')]),t._v(" "),a("td",[t._v("YGC/FGC最大耗时及其原因")]),t._v(" "),a("td",[t._v('jvm_gc_pause_seconds_max{action="end of major GC",cause="Metadata GC Threshold",} 0.0')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_overhead_percent")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("GC消耗cpu的比例")]),t._v(" "),a("td",[t._v("jvm_gc_overhead_percent 0.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_memory_promoted_bytes_total")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("从GC之前到GC之后老年代内存池大小正增长的累计")]),t._v(" "),a("td",[t._v("jvm_gc_memory_promoted_bytes_total 8425512.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_max_data_size_bytes")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("老年代内存的历史最大值")]),t._v(" "),a("td",[t._v("jvm_gc_max_data_size_bytes 2.863661056E9")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_live_data_size_bytes")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("GC后老年代内存的大小")]),t._v(" "),a("td",[t._v("jvm_gc_live_data_size_bytes 8450088.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_gc_memory_allocated_bytes_total")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("在一个GC之后到下一个GC之前年轻代增加的内存")]),t._v(" "),a("td",[t._v("jvm_gc_memory_allocated_bytes_total 4.2979144E7")])])])]),t._v(" "),a("h5",{attrs:{id:"_4-4-1-3-内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-3-内存"}},[t._v("#")]),t._v(" 4.4.1.3. 内存")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("jvm_buffer_memory_used_bytes")]),t._v(" "),a("td",[t._v('id="direct/mapped"')]),t._v(" "),a("td",[t._v("已经使用的缓冲区大小")]),t._v(" "),a("td",[t._v('jvm_buffer_memory_used_bytes{id="direct",} 3.46728099E8')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_buffer_total_capacity_bytes")]),t._v(" "),a("td",[t._v('id="direct/mapped"')]),t._v(" "),a("td",[t._v("最大缓冲区大小")]),t._v(" "),a("td",[t._v('jvm_buffer_total_capacity_bytes{id="mapped",} 0.0')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_buffer_count_buffers")]),t._v(" "),a("td",[t._v('id="direct/mapped"')]),t._v(" "),a("td",[t._v("当前缓冲区数量")]),t._v(" "),a("td",[t._v('jvm_buffer_count_buffers{id="direct",} 183.0')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_memory_committed_bytes")]),t._v(" "),a("td",[t._v('{area="heap/nonheap",id="xxx",}')]),t._v(" "),a("td",[t._v("当前向JVM申请的内存大小")]),t._v(" "),a("td",[t._v('jvm_memory_committed_bytes{area="heap",id="Par Survivor Space",} 2.44252672E8'),a("br"),t._v('jvm_memory_committed_bytes{area="nonheap",id="Metaspace",} 3.9051264E7'),a("br")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_memory_max_bytes")]),t._v(" "),a("td",[t._v('{area="heap/nonheap",id="xxx",}')]),t._v(" "),a("td",[t._v("JVM最大内存")]),t._v(" "),a("td",[t._v('jvm_memory_max_bytes{area="heap",id="Par Survivor Space",} 2.44252672E8'),a("br"),t._v('jvm_memory_max_bytes{area="nonheap",id="Compressed Class Space",} 1.073741824E9')])]),t._v(" "),a("tr",[a("td",[t._v("jvm_memory_used_bytes")]),t._v(" "),a("td",[t._v('{area="heap/nonheap",id="xxx",}')]),t._v(" "),a("td",[t._v("JVM已使用内存大小")]),t._v(" "),a("td",[t._v('jvm_memory_used_bytes{area="heap",id="Par Eden Space",} 1.000128376E9'),a("br"),t._v('jvm_memory_used_bytes{area="nonheap",id="Code Cache",} 2.9783808E7'),a("br")])])])]),t._v(" "),a("h5",{attrs:{id:"_4-4-1-4-classes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-4-classes"}},[t._v("#")]),t._v(" 4.4.1.4. Classes")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("jvm_classes_unloaded_classes_total")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("jvm累计卸载的class数量")]),t._v(" "),a("td",[t._v("jvm_classes_unloaded_classes_total 680.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_classes_loaded_classes")]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("jvm累计加载的class数量")]),t._v(" "),a("td",[t._v("jvm_classes_loaded_classes 5975.0")])]),t._v(" "),a("tr",[a("td",[t._v("jvm_compilation_time_ms_total")]),t._v(" "),a("td",[t._v('{compiler="HotSpot 64-Bit Tiered Compilers",}')]),t._v(" "),a("td",[t._v("jvm耗费在编译上的时间")]),t._v(" "),a("td",[t._v('jvm_compilation_time_ms_total{compiler="HotSpot 64-Bit Tiered Compilers",} 107092.0')])])])]),t._v(" "),a("h4",{attrs:{id:"_4-4-2-日志-logback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-日志-logback"}},[t._v("#")]),t._v(" 4.4.2. 日志(logback)")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Metric")]),t._v(" "),a("th",[t._v("Tag")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("logback_events_total")]),t._v(" "),a("td",[t._v('{level="trace/debug/info/warn/error",}')]),t._v(" "),a("td",[t._v("trace/debug/info/warn/error日志累计数量")]),t._v(" "),a("td",[t._v('logback_events_total{level="warn",} 0.0')])])])]),t._v(" "),a("h3",{attrs:{id:"_4-5-自定义添加埋点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-自定义添加埋点"}},[t._v("#")]),t._v(" 4.5. 自定义添加埋点")]),t._v(" "),a("p",[t._v("如果想自己在IoTDB中添加更多Metrics埋点，可以参考"),a("a",{attrs:{href:"https://github.com/apache/iotdb/tree/master/metrics",target:"_blank",rel:"noopener noreferrer"}},[t._v("IoTDB Metrics Framework"),a("OutboundLink")],1),t._v("使用说明")]),t._v(" "),a("h2",{attrs:{id:"_5-怎样获取这些metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-怎样获取这些metrics"}},[t._v("#")]),t._v(" 5. 怎样获取这些metrics？")]),t._v(" "),a("p",[t._v("metric采集默认是关闭的，需要先到conf/iotdb-metric.yml中打开后启动server，目前也支持启动后，通过"),a("code",[t._v("load configuration")]),t._v("热加载。")]),t._v(" "),a("h3",{attrs:{id:"_5-1-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置文件"}},[t._v("#")]),t._v(" 5.1. 配置文件")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否启动监控模块，默认为false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableMetric")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据提供方式，对外部通过jmx和prometheus协议提供metrics的数据, 可选参数：[jmx, prometheus, iotdb],iotdb是默认关闭的。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metricReporterList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" jmx\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" prometheus\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 底层使用的metric架构，可选参数：[micrometer, dropwizard]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitorType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" micrometer\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 预定义的指标集, 可选参数: [jvm, logback], 其中logback在dropwizard中不支持")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predefinedMetrics")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" jvm\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" logback\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据推送时间，该参数只对 monitorType=dropwizard生效")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pushPeriodInSecond")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("########################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                                                      #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if the reporter is prometheus,                       #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# then the following must be set.                      #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if you use dropwizard, all below                     #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# should be the config of pushgateway                  #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                                                      #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("########################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheusReporterConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheusExporterUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheusExporterPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9091")]),t._v("\t\t\t\t\t\t\t\t\t\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("p",[t._v("然后按照下面的操作获取metrics数据")]),t._v(" "),a("ol",[a("li",[t._v("打开配置文件中的metric开关")]),t._v(" "),a("li",[t._v("其他参数默认不动即可")]),t._v(" "),a("li",[t._v("如果使用"),a("code",[t._v("monitorType: dropwizard")]),t._v("框架，在启动IoTDB前请先在"),a("code",[t._v("prometheusReporterConfig")]),t._v("的对应位置启动pushgateway")]),t._v(" "),a("li",[t._v("启动IoTDB")]),t._v(" "),a("li",[t._v("打开浏览器或者用"),a("code",[t._v("curl")]),t._v(" 访问 "),a("code",[t._v("http://servier_ip:9091/metrics")]),t._v(", 就能看到metric数据了:")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('...\n# HELP file_count\n# TYPE file_count gauge\nfile_count{name="wal",} 0.0\nfile_count{name="unseq",} 0.0\nfile_count{name="seq",} 2.0\n# HELP file_size\n# TYPE file_size gauge\nfile_size{name="wal",} 0.0\nfile_size{name="unseq",} 0.0\nfile_size{name="seq",} 560.0\n# HELP queue\n# TYPE queue gauge\nqueue{name="flush",status="waiting",} 0.0\nqueue{name="flush",status="running",} 0.0\n# HELP quantity\n# TYPE quantity gauge\nquantity{name="timeSeries",} 1.0\nquantity{name="storageGroup",} 1.0\nquantity{name="device",} 1.0\n# HELP logback_events_total Number of error level events that made it to the logs\n# TYPE logback_events_total counter\nlogback_events_total{level="warn",} 0.0\nlogback_events_total{level="debug",} 2760.0\nlogback_events_total{level="error",} 0.0\nlogback_events_total{level="trace",} 0.0\nlogback_events_total{level="info",} 71.0\n# HELP mem\n# TYPE mem gauge\nmem{name="storageGroup",} 0.0\nmem{name="mtree",} 1328.0\n...\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br")])]),a("h3",{attrs:{id:"_5-2-对接prometheus和grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-对接prometheus和grafana"}},[t._v("#")]),t._v(" 5.2. 对接Prometheus和Grafana")]),t._v(" "),a("p",[t._v("如上面所述，IoTDB对外透出标准Prometheus格式的metrics数据，可以直接和Prometheus以及Grafana集成。")]),t._v(" "),a("p",[t._v("IoTDB、Prometheus、Grafana三者的关系如下图所示:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/apache/iotdb-bin-resources/main/docs/UserGuide/System%20Tools/Metrics/iotdb_prometheus_grafana.png",alt:"iotdb_prometheus_grafana"}})]),t._v(" "),a("ol",[a("li",[t._v("IoTDB在运行过程中持续收集metrics数据。")]),t._v(" "),a("li",[t._v("Prometheus以固定的间隔（可配置）从IoTDB的HTTP接口拉取metrics数据。")]),t._v(" "),a("li",[t._v("Prometheus将拉取到的metrics数据存储到自己的TSDB中。")]),t._v(" "),a("li",[t._v("Grafana以固定的间隔（可配置）从Prometheus查询metrics数据并绘图展示。")])]),t._v(" "),a("p",[t._v("从交互流程可以看出，我们需要做一些额外的工作来部署和配置Prometheus和Grafana。")]),t._v(" "),a("p",[t._v("比如，你可以对Prometheus进行如下的配置（部分参数可以自行调整）来从IoTDB获取监控数据")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("metrics\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("honor_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("honor_timestamps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15s\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /metrics\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("follow_redirects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9091")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("更多细节可以参考下面的文档：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://prometheus.io/docs/prometheus/latest/getting_started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus安装使用文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus从HTTP接口拉取metrics数据的配置说明"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://grafana.com/docs/grafana/latest/getting-started/getting-started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grafana安装使用文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://prometheus.io/docs/visualization/grafana/#grafana-support-for-prometheus",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grafana从Prometheus查询数据并绘图的文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("最后是IoTDB的metrics数据在Grafana中显示的效果图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/apache/iotdb-bin-resources/main/docs/UserGuide/System%20Tools/Metrics/metrics_demo_1.png",alt:"metrics_demo_1"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://raw.githubusercontent.com/apache/iotdb-bin-resources/main/docs/UserGuide/System%20Tools/Metrics/metrics_demo_2.png",alt:"metrics_demo_2"}})])])}),[],!1,null,null,null);e.default=s.exports}}]);