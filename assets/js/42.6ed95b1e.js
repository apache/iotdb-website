(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{362:function(t,e,r){"use strict";r.r(e);var a=r(1),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),r("p",[t._v("Wide table structure: Tsfile native format, IOTDB native path format")]),t._v(" "),t._m(4),t._v(" "),r("p",[t._v("Narrow table structure: Relational database schema, IOTDB align by device format")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),r("p",[t._v("This step is to make the table structure of the DataFrame match the table structure of the Tsfile to be queried.\nThe main logic is inferSchema function in src / main / scala / org / apache / iotdb / spark / tsfile / DefaultSource.scala")]),t._v(" "),t._m(8),t._v(" "),r("p",[t._v("The purpose of this step is to transform user SQL statements into Tsfile native query expressions.")]),t._v(" "),r("p",[t._v("The main logic is the buildReader function in src / main / scala / org / apache / iotdb / spark / tsfile / DefaultSource.scala. SQL parsing wide table structure and narrow table structure")]),t._v(" "),t._m(9),t._v(" "),r("p",[t._v("The main logic of the SQL analysis of the wide table structure is in src / main / scala / org / apache / iotdb / spark / tsfile / WideConverter.scala. This structure is basically the same as the Tsfile native query structure. No special processing is required, and the SQL statement is directly converted into  Corresponding query expression")]),t._v(" "),t._m(10),t._v(" "),r("p",[t._v("The main logic of the SQL analysis of the wide table structure is src / main / scala / org / apache / iotdb / spark / tsfile / NarrowConverter.scala. After the SQL is converted to an expression, the narrow table structure is different from the Tsfile native query structure.  The expression is converted into a disjunction expression related to the device before it can be converted into a query of Tsfile. The conversion code is in src / main / java / org / apache / iotdb / spark / tsfile / qp")]),t._v(" "),t._m(11),t._v(" "),r("p",[t._v("The actual data query execution is performed by the Tsfile native component, see:")]),t._v(" "),r("ul",[r("li",[r("router-link",{attrs:{to:"./../1-TsFile/4-Read.html"}},[t._v("Tsfile native query process")])],1)]),t._v(" "),t._m(12),t._v(" "),r("p",[t._v("Writing is mainly to convert the data in the Dataframe structure into Tsfile's RowRecord, and write using Tsfile Writer")]),t._v(" "),t._m(13),t._v(" "),r("p",[t._v("The main conversion code is in the following two files:")]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),r("p",[t._v("The main conversion code is in the following two files:")]),t._v(" "),t._m(16)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"spark-tsfile-connector"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#spark-tsfile-connector"}},[this._v("#")]),this._v(" Spark Tsfile connector")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"aim-of-design"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aim-of-design"}},[this._v("#")]),this._v(" aim of design")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v("Use Spark SQL to read the data of the specified Tsfile and return it to the client in the form of a Spark DataFrame")])]),this._v(" "),e("li",[e("p",[this._v("Generate Tsfile with data from Spark Dataframe")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"supported-formats"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#supported-formats"}},[this._v("#")]),this._v(" Supported formats")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("table",[r("thead",[r("tr",[r("th",[t._v("time")]),t._v(" "),r("th",[t._v("root.ln.wf02.wt02.temperature")]),t._v(" "),r("th",[t._v("root.ln.wf02.wt02.status")]),t._v(" "),r("th",[t._v("root.ln.wf02.wt02.hardware")]),t._v(" "),r("th",[t._v("root.ln.wf01.wt01.temperature")]),t._v(" "),r("th",[t._v("root.ln.wf01.wt01.status")]),t._v(" "),r("th",[t._v("root.ln.wf01.wt01.hardware")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("2.2")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("false")]),t._v(" "),r("td",[t._v("aaa")]),t._v(" "),r("td",[t._v("2.2")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("2.1")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("4")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("bbb")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("5")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("false")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("6")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("ccc")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")])])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("table",[r("thead",[r("tr",[r("th",[t._v("time")]),t._v(" "),r("th",[t._v("device_name")]),t._v(" "),r("th",[t._v("status")]),t._v(" "),r("th",[t._v("hardware")]),t._v(" "),r("th",[t._v("temperature")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("2.2")])]),t._v(" "),r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("2.2")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),r("td",[t._v("false")]),t._v(" "),r("td",[t._v("aaa")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("2.1")])]),t._v(" "),r("tr",[r("td",[t._v("4")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),r("td",[t._v("true")]),t._v(" "),r("td",[t._v("bbb")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("5")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),r("td",[t._v("false")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("null")])]),t._v(" "),r("tr",[r("td",[t._v("6")]),t._v(" "),r("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),r("td",[t._v("null")]),t._v(" "),r("td",[t._v("ccc")]),t._v(" "),r("td",[t._v("null")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"query-process-steps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#query-process-steps"}},[this._v("#")]),this._v(" Query process steps")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_1-table-structure-inference-and-generation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-table-structure-inference-and-generation"}},[this._v("#")]),this._v(" 1. Table structure inference and generation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_2-sql-parsing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-sql-parsing"}},[this._v("#")]),this._v(" 2. SQL parsing")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_3-wide-table-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-wide-table-structure"}},[this._v("#")]),this._v(" 3. Wide table structure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_4-narrow-table-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-narrow-table-structure"}},[this._v("#")]),this._v(" 4. Narrow table structure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_5-query-execution"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-query-execution"}},[this._v("#")]),this._v(" 5. Query execution")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"write-step-flow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#write-step-flow"}},[this._v("#")]),this._v(" Write step flow")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"wide-table-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wide-table-structure"}},[this._v("#")]),this._v(" Wide table structure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/WideConverter.scala responsible for structural transformation")])]),this._v(" "),e("li",[e("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/WideTsFileOutputWriter.scala responsible for matching the spark interface and performing writes, which will call the structure conversion function in the previous file")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"narrow-table-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#narrow-table-structure"}},[this._v("#")]),this._v(" Narrow table structure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/NarrowConverter.scala responsible for structural transformation")])]),this._v(" "),e("li",[e("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/NarrowTsFileOutputWriter.scala responsible for matching the spark interface and performing writes, which will call the structure conversion function in the previous file")])])])}],!1,null,null,null);e.default=s.exports}}]);